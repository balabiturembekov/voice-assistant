# Email DNS Configuration Guide

## –ü—Ä–æ–±–ª–µ–º–∞: SMTP HELO/hostname mismatch

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:
```
SMTP recipients refused: Mail appeared to be SPAM or forged. 
MTA helo: w01da240.kasserver.com, MTA hostname: unknown[217.11.76.90] 
(helo/hostname mismatch)
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ SMTP —Å–µ—Ä–≤–µ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–∏—Å—å–º–∞ –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–∂–¥—É HELO –∏ —Ä–µ–∞–ª—å–Ω—ã–º hostname/IP.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–∞—à —Ñ–∏–∫—Å

‚úÖ **–£–±–∏—Ä–∞–µ—Ç HELO mismatch** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π hostname –≤–º–µ—Å—Ç–æ –¥–æ–º–µ–Ω–∞ email  
‚úÖ **–°–Ω–∏–∂–∞–µ—Ç spam-score** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π HELO —É–º–µ–Ω—å—à–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–ø–∞–º  
‚ùå **–ù–ï –∑–∞–º–µ–Ω—è–µ—Ç PTR / SPF / DKIM** - —ç—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã

## –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### 1. PTR –∑–∞–ø–∏—Å—å (Reverse DNS)

PTR –∑–∞–ø–∏—Å—å —Å–≤—è–∑—ã–≤–∞–µ—Ç IP –∞–¥—Ä–µ—Å —Å –¥–æ–º–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º. –ë–µ–∑ –Ω–µ—ë SMTP —Å–µ—Ä–≤–µ—Ä –≤–∏–¥–∏—Ç "unknown[IP]".

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –°–≤—è–∂–∏—Ç–µ—Å—å —Å –≤–∞—à–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–∞
- –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å PTR –∑–∞–ø–∏—Å—å –¥–ª—è IP –∞–¥—Ä–µ—Å–∞ `217.11.76.90`
- PTR –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –¥–æ–º–µ–Ω, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –≤–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `w01da240.kasserver.com`)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
dig -x 217.11.76.90
# –∏–ª–∏
host 217.11.76.90
```

### 2. SPF –∑–∞–ø–∏—Å—å (Sender Policy Framework)

SPF –∑–∞–ø–∏—Å—å —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å email –æ—Ç –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –î–æ–±–∞–≤—å—Ç–µ SPF –∑–∞–ø–∏—Å—å –≤ DNS –¥–ª—è –¥–æ–º–µ–Ω–∞ `jvmoebel.de`
- –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:
  ```
  v=spf1 ip4:217.11.76.90 include:w01da240.kasserver.com ~all
  ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
dig TXT jvmoebel.de | grep spf
```

### 3. DKIM –ø–æ–¥–ø–∏—Å—å (DomainKeys Identified Mail)

DKIM –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø–æ–¥–ø–∏—Å—å –∫ –ø–∏—Å—å–º–∞–º, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—è –∏—Ö –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DKIM –Ω–∞ –ø–æ—á—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- –î–æ–±–∞–≤—å—Ç–µ DKIM –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ DNS –∫–∞–∫ TXT –∑–∞–ø–∏—Å—å
- –û–±—ã—á–Ω–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
dig TXT default._domainkey.jvmoebel.de
```

## –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π –∑–∞–π–º—ë—Ç –≤—Ä–µ–º—è, –º–æ–∂–Ω–æ:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π hostname** (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ)
   - –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `socket.gethostname()`
   - –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏ HELO mismatch

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å MAIL_HELO_HOSTNAME** –≤ `.env`:
   ```
   MAIL_HELO_HOSTNAME=–≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-hostname
   ```
   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ hostname, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç IP –∞–¥—Ä–µ—Å—É –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

3. **–°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**
   - –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—à IP –≤ whitelist
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ HELO

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ PTR
dig -x 217.11.76.90

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SPF
dig TXT jvmoebel.de | grep spf

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DKIM
dig TXT default._domainkey.jvmoebel.de

# –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
# - https://mxtoolbox.com/
# - https://www.mail-tester.com/
```

## –í–∞–∂–Ω–æ

‚ö†Ô∏è  **–ë–µ–∑ PTR/SPF/DKIM –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ SMTP —Å–µ—Ä–≤–µ—Ä—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥—É—Ç –æ—Ç–∫–∞–∑—ã–≤–∞—Ç—å –ø–∏—Å—å–º–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ HELO mismatch –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.

‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ –∑–∞–ø–∏—Å–∏** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏ email.

üìã **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

